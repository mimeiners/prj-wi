
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Die Spielsteuerung des Kickers &#8212; PRJ2/PRJ3 Wohninvest 4.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=f78ba3b0" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link media="all" rel="stylesheet" type="text/css" href="https://dokie.li/media/css/dokieli.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=e637711f"></script>
    <script src="../../_static/copybutton.js?v=56c01ce6"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script async="async" kind="dokieli" src="https://dokie.li/scripts/dokieli.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "mimeiners/prj-wi");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=afe5de03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/Kicker/03_Spielsteuerung';</script>
    <link rel="canonical" href="https://mimeiners.github.io/prj-wi/docs/Kicker/03_Spielsteuerung.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Bekannte Probleme mit dem Kicker" href="04_known_issues.html" />
    <link rel="prev" title="Ergebnis-Seite" href="02_Webseite/07_Webseite_endgame.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../about/unsyllabus.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/hsb-logo.png" class="logo__image only-light" alt="PRJ2/PRJ3 Wohninvest 4.0 - Home"/>
    <script>document.write(`<img src="../../_static/hsb-logo.png" class="logo__image only-dark" alt="PRJ2/PRJ3 Wohninvest 4.0 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../about/unsyllabus.html">
                    <no title>
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">HowTo</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../HowTo/HowTo_JB.html">How-To Jupyter-Book</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Gesamtsystem</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Gesamtsystem/Projektbeschreibung.html">Projektbeschreibung</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="temp_prj_wohlinvest_requierements.html">Wohlinvestment Anforderungen</a></li>

<li class="toctree-l2"><a class="reference internal" href="../AuVAReS/01_Requirements.html">Anforderungen AuVAReS</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Gesamtsystem/interface_management.html">Schnittstelle Kicker - AuVAReS</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Gesamtsystem/network-communication-keywords.html">Schlüsselwörter bei Kommunikation im Netzwerk von Kicker-AuVAReS</a></li>


</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Hardware-Setup</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../AuVAReS/Anleitungen/setup.html">AuVAReS Nvidia Jetson Setup</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Kicker</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="01_Setup/00_Setup_index.html">Tischkicker Setup</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="01_Setup/01_Webserver.html">Einrichtung von Webserver und Hotspot</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_Setup/02_Datenbank.html">Einrichtung von influxDB und Grafana</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_Setup/03_Nutzerkontoverwaltung.html">Einrichtung der Nutzerkontoverwaltung</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_Setup/04_Material.html">Listung der Materialien</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_Setup/05_Verdrahtung.html">Übersicht der Verdrahtung des Subsystems</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_Setup/06_Kurbelerkennung.html">Dokumentation zur Kurbelerkennung</a></li>


<li class="toctree-l2"><a class="reference internal" href="01_Setup/07_3D-Modelle.html">Dokumentation zu den 3D-Modellen</a></li>




</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="02_Webseite/00_Webseite_Struktur.html">Funktionen der Webseite</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="02_Webseite/01_Webseite_pregame.html">Anmelde- und Registrierungsvorgänge der Webseite</a></li>

<li class="toctree-l2"><a class="reference internal" href="02_Webseite/02_Webseite_ingame.html">Spielsteuerung und Übersicht</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_Webseite/03_Webseite_json_abfrage.html">Spieldatenabfrage mit JSON-Datei</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_Webseite/04_Webseite_json_beschreiben.html">Spieldatenverwaltung mit JSON-Datei</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_Webseite/05_Webseite_Datenbankabfrage.html">Voraussetzungen und Installation der InfluxDB PHP Library</a></li>

<li class="toctree-l2"><a class="reference internal" href="02_Webseite/06_Webseite_Anzeigetafel.html">Spielstandsanzeige auf Anzeigetafel</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_Webseite/07_Webseite_endgame.html">Spielabwicklung und Ergebnisbestimmung</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Programmablauf zur Spielsteuerung</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_known_issues.html">Bekannte Probleme</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_Appendix/01_Kicker.html">Dokumentation des Vorgängerprojekts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">AuVAReS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../AuVAReS/Anleitungen/Programm-AuVAReS.html">Programmablauf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AuVAReS/Anleitungen/Objekterkennung.html">Objekterkennung</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AuVAReS/Anleitungen/Known_Issues.html">Bekannte Probleme</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Meetings</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Meetings/04-11_Protokoll.html">Kick-Off</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Meetings/04-17_Protokoll.html">Meeting am 2024-04-17</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Meetings/05-03_Protokoll.html">Meeting am 2024-05-03</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mimeiners/prj-wi" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mimeiners/prj-wi/edit/master/docs/Kicker/03_Spielsteuerung.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mimeiners/prj-wi/issues/new?title=Issue%20on%20page%20%2Fdocs/Kicker/03_Spielsteuerung.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/docs/Kicker/03_Spielsteuerung.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Die Spielsteuerung des Kickers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hauptdatei-lvl1-threads-py">Hauptdatei (LVL1_threads.py)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#torerkennung-lvl2-goal-detection-py">Torerkennung (LVL2_goal_detection.py)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kurbelerkennung-lvl2-foul-detection-py">Kurbelerkennung (LVL2_foul_detection.py)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interface-lvl2-interface-py">Interface (LVL2_interface.py)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#speicherorte">Speicherorte</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#struktur">Struktur</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#lvl2-interface-py">LvL2_interface.py</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#lvl3-classes-py">LVL3_classes.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#empfangen-von-nachrichten-ack-und-nack">Empfangen von Nachrichten, ACK und NACK</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#konzept">Konzept</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#umsetzung">Umsetzung</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sende-funktion-und-verbindungsstatus">Sende Funktion und Verbindungsstatus</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Konzept</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Umsetzung</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verbindungsaufbau">Verbindungsaufbau</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Konzept</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Umsetzung</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spielkonfiguration-lvl2-pregame-py">Spielkonfiguration (LVL2_pregame.py)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variablen-und-routinen-lvl3-classes-py">Variablen und Routinen (LVL3_classes.py)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#init">init()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#schnittstelle">Schnittstelle</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spielphase">Spielphase</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-status">set_status()</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#event-reactions">event reactions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#react-goal">react_goal()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#react-foul">react_foul()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#react-drone-connected-react-drone-wants-gamestart">react_drone_connected() &amp; react_drone_wants_gamestart</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#react-drone-pleasewait-react-drone-pleaseresume">react_drone_pleasewait &amp; react_drone_pleaseresume</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#database-website">Database &amp; Website</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#database-write">database_write()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#json-read">json_read()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#json-write">json_write()</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="die-spielsteuerung-des-kickers">
<h1>Die Spielsteuerung des Kickers<a class="headerlink" href="#die-spielsteuerung-des-kickers" title="Link to this heading">#</a></h1>
<p>Die Spielsteuerung ist die zentrale Logik des Kickers. Sie besteht aus sechs python-Skripts, die in drei Ebenen oder Level unterteilt sind:</p>
<ul class="simple">
<li><p>Level 1: die oberste Ebene, in der alle Threads gestartet werden</p></li>
<li><p>Level 2: Subsysteme, die parallel ausgeführt werden</p></li>
<li><p>Level 3: hier sind globale Variablen vorhanden, auf die mehrere LVL2-Programme zugreifen; sowie Übersicht über die Routinen und Reaktionen auf Events in Level 2</p></li>
</ul>
<p>Diese Hierarchie entsteht daraus, dass Variablen in ein Python-Skript importiert werden können, aber nicht wieder zurückgegeben werden können. Wenn ein Subsystem den Punktestand ändert, und ein anderes diesen auslesen will, muss dieser Wert in einer Import-Ebene unter beiden liegen - dafür ist Level 3 vorhanden. Diese Problematik gäbe es mit einer einzigen Datei nicht; der Übersicht halber wurden die Subsysteme aber aufgeteilt. Außerdem ermöglicht die Aufteilung ein besseres Arbeiten mit GIT, da einfacher an mehreren Dateien gleichzeitig gearbeitet werden kann, ohne viele merge conflicts zu erzeugen.</p>
<p><img alt="alt text" src="../../_images/Threadverlauf.jpg" /></p>
<section id="hauptdatei-lvl1-threads-py">
<h2>Hauptdatei (LVL1_threads.py)<a class="headerlink" href="#hauptdatei-lvl1-threads-py" title="Link to this heading">#</a></h2>
<p>Diese Datei ist die Datei, von der aus alles aufgerufen wird und Threads gestartet werden. Diese Datei sollte automatisch nach booten des Pis gestartet werden, um Spiele zu ermöglichen. <strong>Dieses Skript muss als Admin ausgeführt werden, da GPIO in LVL2 sonst nicht verwendet werden kann.</strong>
Eine Ausnahme der Skript-Anordnung stellt hier die Not-Aus-Routine dar, da sie nicht auf Level 2 sondern auch in Level 1 enthalten ist. Dadurch wird gewährleistet, dass die Funktion immer verfügbar ist und nicht eine andere Datei durch ihr Fehlen die Not-Aus-Funktion beeinträchtigt. (Das System wurde außerhalb des Labors nicht in Betrieb genommen und der Taster wurde nicht eingebaut. Es war auch ein normaler Taster und kein geeigneter Unterbrecher.)</p>
</section>
<section id="torerkennung-lvl2-goal-detection-py">
<h2>Torerkennung (LVL2_goal_detection.py)<a class="headerlink" href="#torerkennung-lvl2-goal-detection-py" title="Link to this heading">#</a></h2>
<p>Zwei Pins des GPIO des Raspberrys werden auf LOW geprüft, was beduetet, dass ein Reflektionslichttaster in der Ballrückgabe ausgelöst wurde. <strong>Muss als Admin ausgeführt werden (bzw. LVL1, das LVL2 importiert).</strong>
Der Code ist sehr übersichtlich und einfach zu verstehen. Die Funktion <code class="docutils literal notranslate"><span class="pre">init()</span></code> muss aufgerufen werden, bevor der restliche Code in <code class="docutils literal notranslate"><span class="pre">goal()</span></code> benutzt werden kann. <code class="docutils literal notranslate"><span class="pre">GPIO.setmode(GPIO.BOARD)</span></code> bedeutet, dass als Pinnummern nicht der Name des Pins (z. B. GPIO26), sondern die Position verwendet wird. Alle geraden Pinnummern sind in der rechten Spalte des GPIOs und alle ungeraden links. Pin 40 ist der letzte Pin.
<code class="docutils literal notranslate"><span class="pre">goal()</span></code> ist die Funktion, die als Thread endlos laufen soll. Ist die <a class="reference internal" href="#spielphase"><span class="xref myst">Spielphase</span></a> “ingame”, werden konstant die beiden GPIO-Pins geprüft, an denen die Datenpins der beiden Sensoren zur Torerkennung angeschlossen sind. Löst ein Sensor aus (Pin fällt auf LOW), wird die Funktion <code class="docutils literal notranslate"><span class="pre">lvl3.react_goal()</span></code> mit der Nummer des Spielers aufgerufen. Läuft kein Spiel, ist die Funktion im idle-Zustand (beobachte CPU-Vollast in einzelnen Kernen könnte evtl. hierdurch entstehen, nicht überprüft).</p>
</section>
<section id="kurbelerkennung-lvl2-foul-detection-py">
<h2>Kurbelerkennung (LVL2_foul_detection.py)<a class="headerlink" href="#kurbelerkennung-lvl2-foul-detection-py" title="Link to this heading">#</a></h2>
<p>Die Kurbelerkennung besteht aus der Sicht des Kickers nur aus zwei Arduinos, die bei einem Foul HIGH melden. Zwei Pins des GPIO des Raspberrys werden konstant bei “ingame” auf HIGH geprüft, was beduetet, dass der Arduino einer Spielerseite ein Kurbeln des Spielers detektiert hat.
Restliche Funktionalität ist durch Doku der <a class="reference internal" href="#torerkennung-lvl2-goal-detectionpy"><span class="xref myst">Torerkennung</span></a> zu verstehen.</p>
</section>
<section id="interface-lvl2-interface-py">
<h2>Interface (LVL2_interface.py)<a class="headerlink" href="#interface-lvl2-interface-py" title="Link to this heading">#</a></h2>
<p>War angedacht zur TCP Kommunikation mit einem zweiten Rechner (AuVAReS auf NVIDIA Jetson). So wird der zweite Rechner über Spielevents informiert und kann selber auch Schlüsselwörter senden, um den Spielablauf zu beeinflussen.</p>
<section id="speicherorte">
<h3>Speicherorte<a class="headerlink" href="#speicherorte" title="Link to this heading">#</a></h3>
<p>Die Schnittstelle ist in der Datei <code class="docutils literal notranslate"><span class="pre">LVL2_interface.py</span></code> definiert und enthält auch Funktionen und Definitionen in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code>. <code class="docutils literal notranslate"><span class="pre">LVL2_interface.py</span></code> steuert den Verbindungsstatus, hört auf Schlüsselwörter und interpretiert alle eingehenden Nachrichten. Das Senden von Nachrichten sowie das Verbindungsstatus-Flag und das Finden einer Verbindung sind in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code> definiert. Auf diese Weise können sie leicht von anderen Funktionen aufgerufen werden und die Schnittstelle verwenden, ohne <code class="docutils literal notranslate"><span class="pre">LVL2_interface.py</span></code> importieren zu müssen.</p>
<p>Als eine Level-2-Funktion wird <code class="docutils literal notranslate"><span class="pre">LVL2_interface.py</span></code> bei Systemstart in <code class="docutils literal notranslate"><span class="pre">LVL1_threads.py</span></code> als Thread gestartet.</p>
<section id="struktur">
<h4>Struktur<a class="headerlink" href="#struktur" title="Link to this heading">#</a></h4>
<section id="lvl2-interface-py">
<h5>LvL2_interface.py<a class="headerlink" href="#lvl2-interface-py" title="Link to this heading">#</a></h5>
<p>Der Hauptteil der Schnittstelle ist in <code class="docutils literal notranslate"><span class="pre">LVL2_interface.py</span></code> definiert. Ihre Hauptstruktur ist in der Funktion <code class="docutils literal notranslate"><span class="pre">interface()</span></code> definiert, die in <code class="docutils literal notranslate"><span class="pre">LVL1_threads</span></code> als Thread gestartet wird. Innerhalb von <code class="docutils literal notranslate"><span class="pre">interface()</span></code> gibt es zwei Abschnitte.</p>
<p>Der erste Abschnitt initialisiert das verwendete Schlüsselwortverzeichnis für die Schnittstelle. Dieser Abschnitt enthält auch eine While-Schleife, welche verhindert das die Schnittstellenoperation startet bevor, nach einem Systemstart, eine erste Verbindung gefunden wurde.</p>
<p>Der zweite Abschnitt beinhaltet die Hauptfunktionen der Schnittstelle. Diese werden durch zwei Threads gestartet, von denen jeder eine Funktion ausführt. Die erste Funktion ist <code class="docutils literal notranslate"><span class="pre">_ping()</span></code>, die ein Ping-Schlüsselwort an den verbundenen Client sendet und den aktuellen Verbindungsstatus überwacht. Der zweite Thread ruft die Funktion <code class="docutils literal notranslate"><span class="pre">_recv()</span></code> auf, welche es der Schnittstelle erlaubt jederzeit Nachrichten zu empfangen.</p>
</section>
<section id="lvl3-classes-py">
<h5>LVL3_classes.py<a class="headerlink" href="#lvl3-classes-py" title="Link to this heading">#</a></h5>
<p>Ein weiterer Teil der Schnittstelle befindet sich in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code>. Dieser Teil umfasst drei wesentliche Bestandteile der Schnittstelle: die Funktion <code class="docutils literal notranslate"><span class="pre">_find_connection()</span></code>, die Variable <code class="docutils literal notranslate"><span class="pre">connection_status</span></code> und die Funktion <code class="docutils literal notranslate"><span class="pre">server_send()</span></code>. Diese Bestandteile werden von anderen Funktionen, außerhalb <code class="docutils literal notranslate"><span class="pre">LVL2_interface.py</span></code> benötigt und werden deshalb in Level 3 definiert.</p>
<p>Die Funktion <code class="docutils literal notranslate"><span class="pre">_find_connection()</span></code> sucht nach einer neuen Verbindung. Es wird angenommen, dass zum Zeitpunkt des Funktionsaufrufs keine Verbindung zu einem anderen Gerät besteht. Da eine gefundene Verbindung durch eine Funktion in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code> definiert wurde, müssen alle Aktionen, welche die Schnittstelle betreffen, dem Objekt <code class="docutils literal notranslate"><span class="pre">connection_type_object</span></code> zugeordnet werden. Dieses Objekt umfasst das Verbindungsobjekt, wie es vom Modul <code class="docutils literal notranslate"><span class="pre">socket</span></code> definiert wird. Ein Aufruf dieses Objekts außerhalb von Level 3 könnte beispielsweise so aussehen: <code class="docutils literal notranslate"><span class="pre">LVL3_classes.connection_type_object.eine_funktion()</span></code>.</p>
<p>Die Variable <code class="docutils literal notranslate"><span class="pre">connection_status</span></code> spiegelt den aktuellen Status einer Verbindung wieder. <code class="docutils literal notranslate"><span class="pre">True</span></code> bedeutet, dass eine Verbindung besteht, und <code class="docutils literal notranslate"><span class="pre">False</span></code> bedeutet, dass keine Verbindung besteht. Die bisher nicht erwähnte Funktion <code class="docutils literal notranslate"><span class="pre">set_connection_status()</span></code> wird verwendet, um den Wert von <code class="docutils literal notranslate"><span class="pre">connection_status</span></code> auf einen beliebigen Zustand zu setzen.</p>
<p>Die Funktion <code class="docutils literal notranslate"><span class="pre">server_send()</span></code> kann von jeder Funktion im Code aufgerufen werden, die <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code> importiert hat. Sie ermöglicht es jedem Teil des Codes, eine Nachricht an ein verbundenes Gerät zu senden. Die Funktion beinhaltet automatisch alle notwendigen Schritte für eine erfolgreiche Übertragung.</p>
</section>
</section>
</section>
<section id="empfangen-von-nachrichten-ack-und-nack">
<h3>Empfangen von Nachrichten, ACK und NACK<a class="headerlink" href="#empfangen-von-nachrichten-ack-und-nack" title="Link to this heading">#</a></h3>
<section id="konzept">
<h4>Konzept<a class="headerlink" href="#konzept" title="Link to this heading">#</a></h4>
<p>Das System ist so konzipiert, dass es immer auf eingehende Nachrichten hört, eine ACK-Nachricht sendet und dann auf die empfangene Nachricht reagiert. Während einer Reaktion kann keine andere Nachricht empfangen werden! Das System kann jedoch während einer Reaktion Nachrichten senden.</p>
<p>Wenn ein Schlüsselwort empfangen wird, wird eine Bestätigung (ACK) gesendet. Ein ACK funktioniert wie ein weiteres Schlüsselwort, mit der Einschränkung, dass es nur gesendet wird, wenn sein Schlüsselwort empfangen wurde. Der Sender des Schlüsselworts kann somit überprüfen, ob ein gesendetes Schlüsselwort empfangen wurde. Die Schnittstelle kann auf ein empfangenes ACK genauso reagieren wie auf ein Schlüsselwort. Wenn kein ACK empfangen wurde, wird dies als NACK gezählt. Es gibt keine offizielle Implementierung eines NACK, und es muss bei Bedarf manuell hinzugefügt werden. Die Funktion <code class="docutils literal notranslate"><span class="pre">_ping()</span></code> in <code class="docutils literal notranslate"><span class="pre">LVL2_interface.py</span></code> dient als mögliches Beispiel.</p>
</section>
<section id="umsetzung">
<h4>Umsetzung<a class="headerlink" href="#umsetzung" title="Link to this heading">#</a></h4>
<p>Das Empfangen von Nachrichten erfolgt im zweiten Thread von <code class="docutils literal notranslate"><span class="pre">interface()</span></code> mit dem Funktionsaufruf von <code class="docutils literal notranslate"><span class="pre">_recv()</span></code>. Das eigentliche Empfangen einer Nachricht erfolgt mit der importierten Funktion <code class="docutils literal notranslate"><span class="pre">lvl3.connection_type_object.listen(1024)</span></code>. Der Rest der Funktion ist eine aktive While-Schleife, welche die empfangenen Daten aus <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> decodiert und den Funktionsaufruf von <code class="docutils literal notranslate"><span class="pre">_data_interpret()</span></code> enthält.</p>
<p>Die Funktion <code class="docutils literal notranslate"><span class="pre">_data_interpret()</span></code> wird verwendet, um eine angemessene Reaktion auf eine empfangene Nachricht zu bestimmen. Zuerst erfolgt eine Überprüfung, ob die empfangene Nachricht ein Schlüsselwort oder ein ACK ist. Sollte es sich um ein Schlüsselwort handeln, so wird automatisch ein entsprechendes ACK gesendet. Danach wird entsprechend <code class="docutils literal notranslate"><span class="pre">_keyword_react()</span></code> oder <code class="docutils literal notranslate"><span class="pre">_ack_react()</span></code> aufgerufen. Die Nachricht wird als Argument an diese weitergegeben. Durch eine if/else Kette wird dann eine entsprechde Reaktion ausgeführt. Diese Reaktionen können Funktionsaufrufe seinen, welche lokal in ihren entsprechenden Modulen definiert wurden, oder gleich die entsprechende Reaktion ausgeschrieben (z.B setzen von Variablen, das senden von Schlüsselwöretern etc.).</p>
<p>Alle ACK sind im voherein definiert in der Schlüsselwort Tabelle. Ein NACK ist nicht global definiert sondern muss gesondert eingesetzt werden. Eine mögliche Umsetzung nutzt das Schlüsselwort <code class="docutils literal notranslate"><span class="pre">ping</span></code>. Die Funktion <code class="docutils literal notranslate"><span class="pre">_ping()</span></code> setzt in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code> die <code class="docutils literal notranslate"><span class="pre">ping_ack_flag</span></code> auf <code class="docutils literal notranslate"><span class="pre">False</span></code>. Das zurücksetzen auf <code class="docutils literal notranslate"><span class="pre">True</span></code> erfolgt als Reaktionsfunktion auf das entsprechende ACK <code class="docutils literal notranslate"><span class="pre">hi</span></code>. Nach einer Sekunde wird der Zustand der Flagge überprüft. Sollte dieser dann immer noch <code class="docutils literal notranslate"><span class="pre">False</span></code> sein, wird die Verbidnung geschlossen und eine neue wird gesucht. Ist die Flagge auf <code class="docutils literal notranslate"><span class="pre">True</span></code> gesetzt wird das nächste <code class="docutils literal notranslate"><span class="pre">ping</span></code> gesendet.</p>
</section>
</section>
<section id="sende-funktion-und-verbindungsstatus">
<h3>Sende Funktion und Verbindungsstatus<a class="headerlink" href="#sende-funktion-und-verbindungsstatus" title="Link to this heading">#</a></h3>
<section id="id1">
<h4>Konzept<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>Alle Funktionen außerhalb von <code class="docutils literal notranslate"><span class="pre">LVL2_interface.py</span></code> interagieren nur durch das Senden von Nachrichten mit der Schnittstelle. Die Funktion <code class="docutils literal notranslate"><span class="pre">server_send()</span></code> wurde zu diesem Zweck erstellt. Sie dient als ‘Schnittstelle’ zwischen der eigentlichen Schnittstelle und dem System.</p>
<p>Das Verbindungsstatus-Flag <code class="docutils literal notranslate"><span class="pre">connection_status</span></code>, das in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code> definiert ist, spiegelt den aktuellen Status einer Verbindung wider. Per Definition existiert entweder eine Verbindung (True) oder nicht (False). Alle Funktionen können das Status-Flag überprüfen, sofern sie <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code> importiert haben.</p>
</section>
<section id="id2">
<h4>Umsetzung<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<p>Soll eine Nachricht gesendet werden so geschieht dies über die Funktion <code class="docutils literal notranslate"><span class="pre">sendall()</span></code>. Die Funktion <code class="docutils literal notranslate"><span class="pre">server_send()</span></code> übernimmt diese Funktion und auch alle anderen Aufgaben, die sich durch die Systemstruktur, ergeben. Auch Aufgaben welche immer durchgführt werden müssen, werden übernommen.</p>
<p>Die Funktion kodiert die zu übertragende Nachricht selbst in <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>.</p>
<p>Insgesamt versucht <code class="docutils literal notranslate"><span class="pre">server_send()</span></code> eine Nachricht 6 mal abzuschicken, falls ein vorheriger Versuch fehlschlägt. Zwischen jeden Versuch liegen 0.33 Sekunden wodurch ein Funktionsabruf ungefähr 2 Sekunden dauert. Dieses Intervall wurde gewählt um das ein sekündige Intervall des Pings mit einzuschließen. Sollte eine Verbindung beim Sendeversuch scheitern, kann die Ping Funktion die Verbindung wieder aufbauen und die Nachricht kann gesendet werden. Ein Fehlversuch entsteht wenn der Verbindungsstatus <code class="docutils literal notranslate"><span class="pre">connection_status</span></code> <code class="docutils literal notranslate"><span class="pre">False</span></code> ist.</p>
<p>Sollte der Status <code class="docutils literal notranslate"><span class="pre">True</span></code> sein, nutzt die Funktion das <code class="docutils literal notranslate"><span class="pre">port_lock</span></code>. Die verschieden Locks kommen aus dem thread-modul und verwalten den Zugriff unterschiedlicher threads auf geteilelte Ressourcen.</p>
<p>Der Verbindungsstatus wird von zwei Funktionen verwaltet. <code class="docutils literal notranslate"><span class="pre">_find_connection()</span></code>, definiert in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code>, kann den Verbindungsstatus auf <code class="docutils literal notranslate"><span class="pre">True</span></code> setzen. <code class="docutils literal notranslate"><span class="pre">_ping()</span></code> kann den Verbindungsstatus auf <code class="docutils literal notranslate"><span class="pre">False</span></code> setzen.
Sie kann von allen Funktionen im System abgerufen werden, sollte aber nicht von diesen geändert werden.</p>
<p>Die bisher nicht erwähnte Funktion <code class="docutils literal notranslate"><span class="pre">set_connection_status()</span></code> wird verwendet, um <code class="docutils literal notranslate"><span class="pre">connection_status</span></code> auf einen beliebigen Zustand zu setzen. Diese Funktion wird genutzt, da Bedenken hinsichtlich des importierten Zustands von <code class="docutils literal notranslate"><span class="pre">connection_status</span></code> bestanden. Mit <code class="docutils literal notranslate"><span class="pre">set_connection_status()</span></code> kann die Funktion <code class="docutils literal notranslate"><span class="pre">connection_status</span></code> als lokale Variable in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code> geändert werden, anstatt eine importierte Variable zu verwenden.</p>
</section>
</section>
<section id="verbindungsaufbau">
<h3>Verbindungsaufbau<a class="headerlink" href="#verbindungsaufbau" title="Link to this heading">#</a></h3>
<section id="id3">
<h4>Konzept<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<p>Nach dem Systemstart wird die Suche nach einer Verbindung gestartet. Solange keine Verbindung gefunden wird, findet keine Schnittstellenaktivität statt. Sobald eine Verbindung gefunden wird, wird das Verbindungsmanagement gestartet.</p>
<p>Wenn <code class="docutils literal notranslate"><span class="pre">_ping()</span></code> ein NACK feststellt so wird die aktuelle Verbindung geschlossen und eine neue wird gesucht. Solange keine Verbindung vorliegt werden auch alle Prozesse der Schnittstelle gestoppt bzw. virtuell aufgehalten.</p>
</section>
<section id="id4">
<h4>Umsetzung<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<p>Das System sucht nach einer Verbindung, wenn die Funktion <code class="docutils literal notranslate"><span class="pre">_find_connection()</span></code> aufgerufen wird. Diese Funktion wird zuerst als Daemon-Thread innerhalb von <code class="docutils literal notranslate"><span class="pre">init()</span></code> in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.py</span></code> aufgerufen. Solange keine Verbindung gefunden wird, wird der Schnittstellen-Thread nicht gestartet und bleibt stattdessen in einer While-Schleife gesperrt. Die Bedingung für die While-Schleife ist, dass <code class="docutils literal notranslate"><span class="pre">connection_type_object</span></code> gleich <code class="docutils literal notranslate"><span class="pre">None</span></code> ist. Dies stellt einen definierten Zustand in <code class="docutils literal notranslate"><span class="pre">LVL3_classes.init()</span></code> zu Beginn des Betriebs dar. Sobald eine Verbindung innerhalb von <code class="docutils literal notranslate"><span class="pre">_find_connection()</span></code> hergestellt ist, kehrt die Funktion zurück und beendet ihren Thread. Die While-Schleife wird unterbrochen und der Betrieb der Schnittstelle beginnt. Alle anderen Aufrufe von <code class="docutils literal notranslate"><span class="pre">_find_connection()</span></code> erfolgen innerhalb der Schnittstelle und nur über die Funktion <code class="docutils literal notranslate"><span class="pre">_ping()</span></code>.</p>
<p>Wenn ein NACK erkannt wird dadurch das <code class="docutils literal notranslate"><span class="pre">ping_ack_flag</span></code> <code class="docutils literal notranslate"><span class="pre">False</span></code> ist, eine Sekunde nach dem Senden des Pings, schließt der Server die Verbindung, setzt <code class="docutils literal notranslate"><span class="pre">connection_status</span></code> auf <code class="docutils literal notranslate"><span class="pre">False</span></code> und ruft <code class="docutils literal notranslate"><span class="pre">_find_connection()</span></code> auf. Dieser Aufruf von <code class="docutils literal notranslate"><span class="pre">_find_connection()</span></code> erfolgt ohne Thread. Die Funktion <code class="docutils literal notranslate"><span class="pre">_ping()</span></code> muss daher auf ihre Rückkehr (return) warten und stoppt somit den Betrieb des Ping-Threads, bis eine Verbindung gefunden ist. Der Empfangsthread, der die Funktion <code class="docutils literal notranslate"><span class="pre">_recv()</span></code> aufruft, wird Exceptions auslösen, die einfach durch <code class="docutils literal notranslate"><span class="pre">except:</span> <span class="pre">pass</span></code> abgefangen werden. Die Betriebsfähigkeit der Schnittstelle wird dadurch praktisch gestoppt, bis eine neue Verbindung hergestellt werden kann.</p>
</section>
</section>
</section>
<section id="spielkonfiguration-lvl2-pregame-py">
<h2>Spielkonfiguration (LVL2_pregame.py)<a class="headerlink" href="#spielkonfiguration-lvl2-pregame-py" title="Link to this heading">#</a></h2>
<p>Bevor das Spiel startet, müssen bspw. Spielernamen eingetragen werden. Dieses Skript durchläuft die Vorbereitung des Spiels schrittweise und startet jedes Spiel. Mit der Website wird über game_data.json kommuniziert. Es waren leider keine Web-Developer im Team und daher ist diese fragwürdige Methode nicht ersetzt wurden und wurde so hingenommen. Ob die Lebensdauer der SD-Karte durch die vielen Zugriffe auf diese Datei sinkt, wurde nicht geprüft oder beachtet.
Die einzige Funktion <code class="docutils literal notranslate"><span class="pre">pregame()</span></code> läuft endlos als Thread. Sie ist lang aber linear gegliedert; die Schritte 1 bis 5 passieren in der Phase “wait_pregame” (Achtung: im Code ist eine andere Nummerierung, es geht hier nur um die Reihenfolge).</p>
<ol class="arabic simple" start="0">
<li><p>Nach dem Poweron wird der <a class="reference internal" href="#spielphase"><span class="xref myst">Systemstatus</span></a> auf “wait_pre” gesetzt. Die “init”-Phase ließe sich hier zeitlich verlängern, falls noch mehr Vorbereitungen getroffen werden müssen. Dieses Umschalten passiert einmalig, da die Phase “init” nur automatisch nach dem Poweron besteht.</p></li>
<li><p>Spielernamen: Die JSON-Datei wird beobachtet und sobald Spielernamen auftauchen, werden diese in python übernommen.</p></li>
<li><p>Website Button zum Drohnen-Akku: Hier wird gewartet, bis “button_power” in der JSON auf True gesetzt wird. Das passiert durch Drücken des ersten Bestätigungs-Buttons auf der Website, auch wenn keine Drohne vorhanden ist. Für diese Abfrage gibt es keinen Timeout und es wird endlos auf True gewartet. Anschließend wird AuVAReS das Keyword “notify_drone_powered” zugesendet.</p></li>
<li><p>AuVAReS abwarten: Besteht eine Verbindung zum Jetson-Board, wird die Antwort von AuVAReS abgewartet. Wir warten hier, dass die Drohne sich mit dem Board verbunden hat, bevor Schritt 4 kommt.</p></li>
<li><p>Der zweite Button muss gedrückt werden und setzt “button_start” auf True. Eine Art rechtliche Absicherung, dass der Nutzer die Drohne freigibt, da unser System nicht prüfen kann, ob jemand durch den Start der Drohne gefährdet wäre.</p></li>
<li><p>AuVAReS wird darüber benachrichtigt und wir warten auf Antwort, dass die Drohne sich erfolgreich in Position begeben hat.</p></li>
<li><p>Spielstart: Der unix time stamp wird als GameID gespeichert. Damit sind die Spielereignisse in der Datenbank einem Spiel zuordenbar. In der JSON werden die Button-Werte zurückgesetzt, damit das nächste Spiel nicht automatisch das pregame durchläuft. In python werden Torzählervariablen auf null gesetzt und in die Datenbank wird eine neues Spiel mit Spielernamen und Toren (noch 0:0) geschrieben. Der Spielstatus wird auf “ingame” gesetzt. Jetzt startet das richtige Kickerspiel.</p></li>
</ol>
<p>Über die Website kann das Spiel jederzeit abgebrochen werden. Da <code class="docutils literal notranslate"><span class="pre">pregame()</span></code> während der aktiven Spielphase eigentlich idle ist, kann die Überprüfung des Buttons hier übernommen werden. Es passieren ähnliche Schritte wie bei der normalen Beendigung eines Spiels, wie etwa auch das Löschen der Spielernamen aus der JSON. Hier taucht besonders häufig ein Fehler auf, bei dem “button_stop” nicht erfolgreich aus der JSON gelesen werden konnte, vermutlich aufgrund zeitgleicher Zugriffe durch die Website oder eines Fehlers im Code der Website, der den Wert aus der JSON löscht.</p>
</section>
<section id="variablen-und-routinen-lvl3-classes-py">
<h2>Variablen und Routinen (LVL3_classes.py)<a class="headerlink" href="#variablen-und-routinen-lvl3-classes-py" title="Link to this heading">#</a></h2>
<p>Der Name der Datei stammt aus den Anfängen, als viele Funktionen als Klassen zusammengefasst waren. Hier sind globale Variablen vorhanden, auf die mehrere LVL2-Programme zugreifen; sowie Übersicht über die Routinen und Reaktionen auf Events in Level 2. So soll innerhalb einer Datei die Gesamtheit an Reaktionen auf Spielereignisse erkenntlich sein. In Level 2 werden Ereignisse detektiert oder ausgelöst und die Reaktion darauf findet sich in Level 3.</p>
<section id="init">
<h3>init()<a class="headerlink" href="#init" title="Link to this heading">#</a></h3>
<p>Hier werden ganz viele globale Variablen initialisiert, wie Spielernamen, GameID, Spielstatus uvm. Des Weiteren werden die Socket connection und Verbindung zur Datenbank gestartet.</p>
</section>
<section id="schnittstelle">
<h3>Schnittstelle<a class="headerlink" href="#schnittstelle" title="Link to this heading">#</a></h3>
<p>Die Funktionen <code class="docutils literal notranslate"><span class="pre">_find_connection()</span></code>, <code class="docutils literal notranslate"><span class="pre">server_send()</span></code>, <code class="docutils literal notranslate"><span class="pre">set_connection_status()</span></code> sowie die Variable <code class="docutils literal notranslate"><span class="pre">connection_status</span></code> werden unter <a class="reference internal" href="#lvl2_interfacepy"><span class="xref myst">“LVL2_interface.py”</span></a> erläutert.</p>
</section>
<section id="spielphase">
<h3>Spielphase<a class="headerlink" href="#spielphase" title="Link to this heading">#</a></h3>
<p>Das Spiel ist intern in vier Phasen unterteilt. Durch sie wird bestimmt, welcher Thread wann aktiv ist. Die Begriffe Spielphase, Spielstatus, Systemstatus meinen alle das gleiche.</p>
<ol class="arabic simple">
<li><p>“init”: Nur direkt nach Starten des Codes. Nur <a class="reference internal" href="#spielkonfiguration-lvl2_pregamepy"><span class="xref myst">Pregame</span></a> reagiert auf diese Phase.</p></li>
<li><p>“wait_pre”: Die Vorbereitungsphase eines Spiels, kein anders Skript außer Pregame soll eingreifen</p></li>
<li><p>“ingame”: Das Spiel läuft und die Sensorik wird verwendet</p></li>
<li><p>“wait_ingame”: Das Spiel wurde von einem Event unterbrochen. Das Spiel wird nach Abfertigung des Events fortgesetzt (oder bei einem Sieg beendet, also zu “wait_pre” gewechselt).</p></li>
</ol>
<section id="set-status">
<h4>set_status()<a class="headerlink" href="#set-status" title="Link to this heading">#</a></h4>
<p>Mit dieser Funktion wird der Spielstatus geändert. Dadurch, dass die Variable nicht direkt geändert wird, sondern über ein Funktion, könnten noch zusätzliche Befehle mitangehängt werden, wie hier das Printen einer Nachricht. Zudem können in der Beschreibung der Funktion die gültigen Zustände der Variable gelistet werden.</p>
</section>
</section>
<section id="event-reactions">
<h3>event reactions<a class="headerlink" href="#event-reactions" title="Link to this heading">#</a></h3>
<p>Der Grundgedanke war, die alle Reaktionen auf Spielevents beieinander zu haben, um schnell in einer Datei logische Abläufe und Timings anzupassen.</p>
<section id="react-goal">
<h4>react_goal()<a class="headerlink" href="#react-goal" title="Link to this heading">#</a></h4>
<p>Die Unterscheidung, um welchen Spieler es sich handelt, wird als Argument <code class="docutils literal notranslate"><span class="pre">1</span></code> oder <code class="docutils literal notranslate"><span class="pre">2</span></code> eingegeben. Der interne Torzähler des Spielers wird erhöht, das Tor wird in die Datenbank geschrieben und die Siegesbedingung geprüft. Führt ein Spieler mit 6 Toren oder gibt es ein Unentschieden bei 5:5, ist das Spiel abgeschlossen. Das Spiel wird mit <code class="docutils literal notranslate"><span class="pre">set_status(&quot;wait_pre&quot;)</span></code> beendet und die GameID wird als beendetes Spiel in der JSON festgehalten.
Andernfalls wird das Spiel nach wenigen Sekunden fortgeführt.
Da diese Funktion sofort den Spielstatus auf “wait_ingame” setzt, kann erstmal kein weiteres Tor geschossen werden und der Ball nicht redundant detektiert werden.</p>
</section>
<section id="react-foul">
<h4>react_foul()<a class="headerlink" href="#react-foul" title="Link to this heading">#</a></h4>
<p>Die Reaktion auf ein Foul entstand ganz am Ende des Projekts. Ein Pop-Up auf der Website soll informieren, dass ein Regelverstoß aufgetreten ist (gekurbelt). Dafür wird dem Spieler in der JSON das Foul-Attribut auf True gesetzt und ein paar Sekunden später wieder gelöscht. Auch hier wird das Spiel unterbrochen.
Fun fact: da der Torsensor weit hinten in der Ballrückgabe ist, wird ein Tor erst kurz nach dem tatsächlichen Überschreiten der Torlinie detektiert (eigentlich erst beim Ankommen des Balls im Ausgabefach, hörbar). In dieser Zeit kann der kassierende Spieler absichtlich ein Foul auslösen, um die Erkennung dieses Tores zu blockieren, und das ohne wirkliche Folgen, da ein Foul nicht weiter geahndet wird. Gefähliches Wissen, aber it’s not a bug, it’s a feature.</p>
</section>
<section id="react-drone-connected-react-drone-wants-gamestart">
<h4>react_drone_connected() &amp; react_drone_wants_gamestart<a class="headerlink" href="#react-drone-connected-react-drone-wants-gamestart" title="Link to this heading">#</a></h4>
<p>Die enthaltenen Variablen werden in <a class="reference internal" href="#spielkonfiguration-lvl2_pregamepy"><span class="xref myst">Pregame</span></a> geprüft. Sie werden durch Antwort von AuVAReS (ein bestimmtes Keyword) durch die Funktionen auf True gesetzt. Als Funktion, um print-Ausgabe zu ermöglichen.</p>
</section>
<section id="react-drone-pleasewait-react-drone-pleaseresume">
<h4>react_drone_pleasewait &amp; react_drone_pleaseresume<a class="headerlink" href="#react-drone-pleasewait-react-drone-pleaseresume" title="Link to this heading">#</a></h4>
<p>Eine Reaktion auf das Keyword “please_wait”, falls AuVAReS das Spiel unterbrechen möchte. Die Unterscheidung, ob dies aufgrund eines game events oder Fehlers passiert, wurde erstmal weggelassen. Mit der zweiten Funktion gibt AuVAReS das Spiel wieder frei.</p>
</section>
</section>
<section id="database-website">
<h3>Database &amp; Website<a class="headerlink" href="#database-website" title="Link to this heading">#</a></h3>
<p>Der Dateipfad ist festgeschrieben auf game_data.json.</p>
<section id="database-write">
<h4>database_write()<a class="headerlink" href="#database-write" title="Link to this heading">#</a></h4>
<p>Diese Fuktion ordnet eine Torzahl einem bestimmten Spieler in einem bestimtten Spiel zu.</p>
</section>
<section id="json-read">
<h4>json_read()<a class="headerlink" href="#json-read" title="Link to this heading">#</a></h4>
<p>Es kann ab und zu mal zu einem JSON-Auslesefehler kommen, bei dem die Datei vermutlich leer erscheint. Auswirkungen aufs Spiel sind unberechenbar und abhängig davon, in welchem Skript der Fehler auftritt.</p>
</section>
<section id="json-write">
<h4>json_write()<a class="headerlink" href="#json-write" title="Link to this heading">#</a></h4>
<p>Bevor in die JSON überschrieben wird, sollte zunächst immer der alte Inhalt der Datei geladen werden und gezielt verändert werden.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "mimeiners/prj-wi",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs/Kicker"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="02_Webseite/07_Webseite_endgame.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Ergebnis-Seite</p>
      </div>
    </a>
    <a class="right-next"
       href="04_known_issues.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Bekannte Probleme mit dem Kicker</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hauptdatei-lvl1-threads-py">Hauptdatei (LVL1_threads.py)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#torerkennung-lvl2-goal-detection-py">Torerkennung (LVL2_goal_detection.py)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kurbelerkennung-lvl2-foul-detection-py">Kurbelerkennung (LVL2_foul_detection.py)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interface-lvl2-interface-py">Interface (LVL2_interface.py)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#speicherorte">Speicherorte</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#struktur">Struktur</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#lvl2-interface-py">LvL2_interface.py</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#lvl3-classes-py">LVL3_classes.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#empfangen-von-nachrichten-ack-und-nack">Empfangen von Nachrichten, ACK und NACK</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#konzept">Konzept</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#umsetzung">Umsetzung</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sende-funktion-und-verbindungsstatus">Sende Funktion und Verbindungsstatus</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Konzept</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Umsetzung</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verbindungsaufbau">Verbindungsaufbau</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Konzept</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Umsetzung</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spielkonfiguration-lvl2-pregame-py">Spielkonfiguration (LVL2_pregame.py)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variablen-und-routinen-lvl3-classes-py">Variablen und Routinen (LVL3_classes.py)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#init">init()</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#schnittstelle">Schnittstelle</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spielphase">Spielphase</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-status">set_status()</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#event-reactions">event reactions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#react-goal">react_goal()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#react-foul">react_foul()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#react-drone-connected-react-drone-wants-gamestart">react_drone_connected() &amp; react_drone_wants_gamestart</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#react-drone-pleasewait-react-drone-pleaseresume">react_drone_pleasewait &amp; react_drone_pleaseresume</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#database-website">Database &amp; Website</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#database-write">database_write()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#json-read">json_read()</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#json-write">json_write()</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By M. Meiners / B. Lehmann
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png"></a>
    All content on this site (unless otherwise specified) is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 license</a>
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>